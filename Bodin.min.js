jQuery.fn.cursorToEnd=function(){return this.each(function(){jQuery(this).focus();if(this.setSelectionRange){var a=2*jQuery(this).val().length;this.setSelectionRange(a,a)}else jQuery(this).val(jQuery(this).val());this.scrollTop=999999})};jQuery.fn.myHtml=function(){return jQuery(this).clone().wrap("<div>").parent().html()};jQuery.fn.transLength=function(){var a=jQuery(this).css("transition").match(/ [\d|\.]+s/g);return 1E3*Number(a[0].replace("s",""))};
String.prototype.smoosh=function(){return this.replace(/(\r\n+|\n+|\r+|\t+)/gm,"")};String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+(>|$)/g,"")};String.prototype.oneSpace=function(){return this.replace(/\s{2,}/g," ")};String.prototype.alphaSpaceOnly=function(){return this.replace(/[^\w\s]/gi,"")};String.prototype.alphaOnly=function(){return this.replace(/[^\w]/gi,"")};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};
String.prototype.repeat=function(a){return Array(a+1).join(this)};String.prototype.occurs=function(a,b){if(void 0==a)return this.length;a+="";if(0>=a.length)return this.length;for(var c=0,e=0,d=b?1:a.length;;)if(e=this.indexOf(a,e),0<=e)c++,e+=d;else break;return c};
String.prototype.positions=function(a,b,c,e){a+="";var d=0;b=b?1:a.length;for(var f=[];;){var h=!0,d=this.indexOf(a,d);if(0<=d){if(!0==c)for(var g=d;g<this.length&&"<"!=this[g];g++)">"==this[g]&&(h=!1);!0==e&&!0==this.substr(d-1,d+a.length+1).isAlphaNum()&&(h=!1);!0==h&&f.push(d);d+=b}else break}return f};String.prototype.insertAt=function(a,b){return this.substr(0,a)+b+this.substr(a)};
String.prototype.params=function(){for(var a=this.split("?"),a=a[1].split("&"),b={},c=0,e=a.length;c<e;c++)if(void 0!=a[c]){var d=a[c].split("=");b[d[0]]=d[1]}return b};String.prototype.hasUpper=function(){return/[A-Z]/.test(this)};String.prototype.report=function(){for(var a=this.toLowerCase().split(" "),b={},c=0,e=a.length;c<e;c++){var d=a[c];b[d]=d in b?b[d]+1:1}return b};String.prototype.lines=function(){return this.split("\n")};
String.prototype.isAlphaNum=function(){return/[^a-zA-Z0-9]/.test(this)?!1:!0};String.prototype.sentences=function(){for(var a=this.match(/[^\.!\?]+[\.!\?]+/g),b="aeiouy".split(""),c=[],e="",d=0;d<a.length;d++){for(var f=e+a[d],e="",h=!0,g=0;g<b.length;g++)if(-1!=f.indexOf(b[g])){h=!1;break}f.trim()[0].hasUpper()||(h=!0);h?0<c.length?c[c.length-1]+=f:e=f:c.push(f.smoosh().trim())}return c};ObjectExt=function(){};ObjectExt.prototype.mergeAdd=function(a,b){for(var c in a)b[c]=c in b?b[c]+a[c]:1};
ObjectExt.prototype.totalChars=function(a,b,c){b=void 0==b?0:b;c=void 0==c?0:c;for(var e=0,d=a.length;e<d;e++){if("object"==typeof a[e])return c++,this.totalChars(a[e],b,c);b+=a[e].toString().length}return b};ObjectExt.prototype.totalKeys=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};ObjectExt.prototype.wrap=function(a,b,c){c=void 0==c?b:c;for(var e=[],d=0,f=a.length;d<f;d++)e[d]=b.toString()+a[d]+c.toString();return e};
ObjectExt.prototype.clone=function(a){if(null==a||"_object"!=typeof a)return a;if(a instanceof Date){var b=new Date;b.setTime(a.getTime());return b}if(a instanceof Array){for(var b=[],c=0,e=a.length;c<e;c++)b[c]=this.clone(a[c]);return b}if(a instanceof Object){b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=this.clone(a[c]));return b}throw Error("Unable to copy obj! Its type isn't supported.");};
ObjectExt.prototype.byString=function(a,b){if(void 0==b)return a;b=b.replace(/\[['|"]*(\w+)['|"]*\]/g,".$1");b=b.replace(/^\./,"");for(var c=b.split(".");c.length;){var e=c.shift();if(e in a)a=a[e];else return}return a};function Styler(){this.head=document.getElementsByTagName("head")[0];this.style=document.createElement("style");this.style.type="text/css";this.head.appendChild(this.style)}
Styler.prototype.add=function(a){for(var b in a){var c=document.createTextNode(b+" { "+a[b]+" }");this.style.styleSheet?style.styleSheet.cssText=c.nodeValue:this.style.appendChild(c)}};function Palette(a){this.colors=[];this.load(a)}
Palette.prototype.load=function(a){switch(a){case "grayscale":this.add("#000000 #333333 #666666 #999999 #CCCCCC #FFFFFF".split(" "));break;case "primary":this.add(["#FF0000","#00FF00","#0000FF"]);break;case "secondary":this.add(["#00FFFF","#FF00FF","#FFFF00"]);break;case "candy":this.add(["#F4DDBE","#465A95","#10CCD5","#FD8471","#88D499"]);case "nes":this.add("#7C7C7C #0000FC #0000BC #4428BC #940084 #A80020 #A81000 #881400 #503000 #007800 #006800 #005800 #004058 #000000 #000000 #000000 #BCBCBC #0078F8 #0058F8 #6844FC #D800CC #E40058 #F83800 #E45C10 #AC7C00 #00B800 #00A800 #00A844 #008888 #000000 #000000 #000000 #F8F8F8 #3CBCFC #6888FC #9878F8 #F878F8 #F85898 #F87858 #FCA044 #F8B800 #B8F818 #58D854 #58F898 #00E8D8 #787878 #000000 #000000 #FCFCFC #A4E4FC #B8B8F8 #D8B8F8 #F8B8F8 #F8A4C0 #F0D0B0 #FCE0A8 #F8D878 #D8F878 #B8F8B8 #B8F8D8 #00FCFC #F8D8F8 #000000 #000000".split(" "));
break;case void 0:this.add(["#000000","#FFFFFF"])}};Palette.prototype.reset=function(){this.colors=[]};Palette.prototype.add=function(a){for(var b=0;b<a.length;b++)this.colors.push(new Culuh(a[b]))};Palette.prototype.print=function(){for(var a=0;a<this.colors.length;a++)console.log(this.colors[a].hex())};
Palette.prototype.show=function(a,b){b=void 0==b?20:b;a=void 0==a?this.colors.length:parseInt(a);this.hide();var c=document.createElement("div");c.setAttribute("id","palette-sample");c.style.position="absolute";c.style.left="0";c.style.top="0";document.body.appendChild(c);for(var e=0;e<this.palette.length;e++){var d="#"+this.palette[e].hex(),f=document.createElement("div");f.style.backgroundColor=d;f.style.height=b+"px";f.style.width=b+"px";f.style["float"]="left";c.appendChild(f);e%a==a-1&&c.appendChild(document.createElement("br"))}};
Palette.prototype.hide=function(){var a=document.getElementById("palette-sample");void 0!=a&&a.parentNode.removeChild(a)};
Palette.prototype.sort=function(a){switch(a){case "value":this.sortNum(function(a){return a.v});break;case "hue":this.sortNum(function(a){return a.h});break;case "saturation":this.sortNum(function(a){return a.s});break;case "red":this.sortNum(function(a){var c=(a.gInt()+a.bInt())/2;return a.rInt()-c});break;case "green":this.sortNum(function(a){var c=(a.rInt()+a.bInt())/2;return a.gInt()-c});break;case "blue":this.sortNum(function(a){var c=(a.rInt()+a.gInt())/2;return a.bInt()-c})}};
Palette.prototype.sortNum=function(a){for(var b=new Sorted,c=[],e=0;e<this.colors.length;e++)c[e]={value:a(this.colors[e]),color:this.colors[e]};c=b.numSort(c,"value");for(e=0;e<c.length;e++)this.colors[e]=c[e].color};function Culuh(a){this.v=this.s=this.h=this.b=this.g=this.r=0;void 0!=a&&(this.original=a,this.reset(),this.hsvUpdate())}
Culuh.prototype.reset=function(){var a=this.original,a=a.toUpperCase();-1<a.indexOf("RGB")?(a=a.match(/\d+\.?\d*/g),this.r=parseInt(a[0]),this.g=parseInt(a[1]),this.b=parseInt(a[2])):(a=a.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i),this.r=this.hexToInt(a[1]),this.g=this.hexToInt(a[2]),this.b=this.hexToInt(a[3]))};
Culuh.prototype.hsvUpdate=function(){var a,b;a=this.r/255;var c=this.g/255,e=this.b/255;b=Math.min(a,c,e);var d=Math.max(a,c,e),f=d-b;b=0==d?0:f/d;0==b?a=0:(a=a==d?(c-e)/f:c==d?2+(e-a)/f:4+(a-c)/f,isNaN(a)&&(a=0),a/=6,0>a&&a++);this.h=255*a;this.s=255*b;this.v=255*d};
Culuh.prototype.rgbUpdate=function(){var a,b,c,e=this.h/255,d=this.s/255,f=this.v/255;if(0==d)a=b=c=f;else{var e=6*e,h=e%1,g=f*(1-d),k=f*(1-d*h),d=f*(1-d*(1-h));switch(Math.floor(e)){case 0:a=f;b=d;c=g;break;case 1:a=k;b=f;c=g;break;case 2:a=g;b=f;c=d;break;case 3:a=g;b=k;c=f;break;case 4:a=d;b=g;c=f;break;case 5:a=f,b=g,c=k}}this.r=parseInt(255*a);this.g=parseInt(255*b);this.b=parseInt(255*c)};Culuh.prototype.hex=function(a){return(void 0==a?"":a)+this.rHex()+this.gHex()+this.bHex()};
Culuh.prototype.rgb=function(){return"rgb("+this.r+","+this.g+","+this.b+")"};Culuh.prototype.rHex=function(){return this.intToHex(this.r)};Culuh.prototype.gHex=function(){return this.intToHex(this.g)};Culuh.prototype.bHex=function(){return this.intToHex(this.b)};Culuh.prototype.rInt=function(){return this.r};Culuh.prototype.gInt=function(){return this.g};Culuh.prototype.bInt=function(){return this.b};Culuh.prototype.hexToInt=function(a){return parseInt(a,16)};
Culuh.prototype.intToHex=function(a){a=a.toString(16);2>a.length&&(a="0"+a);return a.toUpperCase()};Culuh.prototype.sat=function(a,b){var c=this.s,c=c*a;if(!0!=b)this.s=c,this.rgbUpdate();else return c=new Culuh(this.rgb()),c.sat(a),c};Culuh.prototype.toAlpha=function(a){a=parseFloat(a);a=0>a?0:a;return"rgba("+this.r+","+this.g+","+this.b+","+(1<a?1:a)+")"};
Culuh.prototype.invert=function(a){if(!0!=a)this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this.hsvUpdate();else return a=new Culuh(this.rgb()),a.invert(),a};
(function(a){function b(a,b,d){this.elem=a;this.id=d;this.init(a,b)}b.prototype.init=function(c,b){a(this.elem).addClass("sidecart");this.config=a.extend({side:"right",inside:!1,"bottom-space":40},b);this.styler=new Styler;this.start()};b.prototype.start=function(){this.buildWrapper();this.buildViews();this.eventStart();this.showFirst();this.hide()};b.prototype.buildWrapper=function(){a(this.elem).addClass("hidden");switch(this.config.side){case "left":this.buildTabsLast();a(this.elem).addClass("left");
break;case "top":this.buildTabsLast();a(this.elem).addClass("top");break;default:a(this.elem).append('\t\t\t\t\t<div class="tabs"></div>\t\t\t\t\t<div class="inner">\t\t\t\t\t\t<div class="views"></div>\t\t\t\t\t</div>\t\t\t\t')}this.fitToParent()};b.prototype.fitToParent=function(){if(!0==this.config.inside){var c=a(this.elem).parent(),b=c.position();a(this.elem).css({left:b.left});"top"==this.config.side&&(a(this.elem).width(c.outerWidth()),c=c.height()-a(".tabs",this.elem).height()-this.config["bottom-space"],
b={},b[this.id+" .inner"]="height:"+c+"px",b[this.id+".hidden .inner"]="height:0",this.styler.add(b))}};b.prototype.buildTabsLast=function(){a(this.elem).append('\t\t\t<div class="inner">\t\t\t\t<div class="views"></div>\t\t\t</div>\t\t\t<div class="tabs"></div>\t\t')};b.prototype.buildTabsFirst=function(){a(this.elem).append('\t\t\t<div class="tabs"></div>\t\t\t<div class="inner">\t\t\t\t<div class="views"></div>\t\t\t</div>\t\t')};b.prototype.buildViews=function(){for(var a=0,b=this.config.views.length;a<
b;a++)this.buildView(this.config.views[a])};b.prototype.buildView=function(c){a(".views",this.elem).append('\t\t\t<div id="'+c.id+'" class="'+c.type+'"></div>\t\t');void 0!=c.src?a(c.src).detach().appendTo("#"+c.id):void 0!=c.text&&a("#"+c.id).append(c.text);var b='<a href="#'+c.id+'">'+c.link+"</a>";a(".tabs",this.elem).append(b);c.init(this)};b.prototype.eventStart=function(){this.tabClick();this.resize()};b.prototype.resize=function(){var c=this;a(window).resize(function(){c.fitToParent()})};b.prototype.tabClick=
function(){var c=this;a(".tabs a",c.elem).on("touchstart click",function(b){b.preventDefault();b=a(this).attr("href").replace("#","");c.showView(b)})};b.prototype.slide=function(){this.hidden()?this.show():this.hide()};b.prototype.hidden=function(){return a(this.elem).hasClass("hidden")};b.prototype.show=function(){a(this.elem).removeClass("hidden")};b.prototype.hide=function(){a(this.elem).addClass("hidden")};b.prototype.hideViews=function(){a(".views ",this.elem).children().hide()};b.prototype.showView=
function(c){c!==this.last_tab?(this.last_tab=c,this.hideViews(),a("#"+c,this.elem).show(),a(".tabs a",this.elem).removeClass("selected"),a('.tabs a[href="#'+c+'"]',this.elem).addClass("selected"),this.hidden()&&this.slide()):this.slide();this.viewRefresh(c)};b.prototype.viewRefresh=function(a){for(var b=0,d=this.config.views.length;b<d;b++){var f=this.config.views[b];f.id==a&&void 0!=f.refresh&&f.refresh(this)}};b.prototype.showFirst=function(){var c=a(".tabs a",this.elem).first().attr("href").replace("#",
"");this.showView(c)};a(document).ready(function(a){a.fn.sidecart=function(e){var d=a(this).selector;return this.each(function(){a.data(this,d,new b(this,e,d))})}})})(jQuery);
var Bodin=function(){if(Bodin.prototype._singleton)return Bodin.prototype._singleton;Bodin.prototype._singleton=this;this.config={};this.bodin_align=new BodinAlign;this.events={loaded:"Bodin-LOADED"};this.start=function(a){var b=this;jQuery(a).each(function(){var a=jQuery(this).attr("id");jQuery(this).attr("src");jQuery("#"+a).on("TeiToBodin-LOADED",function(a,c){b.loadCheck(c)});b.config[a]={teiToBodin:jQuery("#"+a).TeiToBodin().data("#"+a)}})};this.loadCheck=function(a){a=jQuery(a).attr("id");this.config[a].loaded=
!0;for(a in this.config)if(!0!=this.config[a].loaded)return;jQuery(window).trigger(this.events.loaded)}},BodinAlign=function(){if(BodinAlign.prototype._singleton)return BodinAlign.prototype._singleton;BodinAlign.prototype._singleton=this;this.src={};this.alignments={};this.config=null;this.palette=new Palette("primary");this.events={loaded:"BodinAlign-LOADED"};this.start=function(a){this.config=a;for(var b in a)this.src[a[b].src]=1;for(b in this.src)this.alignments[b]={loaded:!1};for(b in this.src)this._get(b)};
this._get=function(a){var b=this;jQuery.get(a).done(function(c){b.alignments[a].xml=c;b.alignments[a].loaded=!0;b.alignments[a].json=b._json(c);b.loadCheck()}).fail(function(){console.log("Could not load alignment xml: "+a)})};this._target=function(a){var b=a.lastIndexOf(":")+1,c=a.indexOf("@");if(-1!=c){var e=a.substr(b,c-b).split("."),b=parseInt(e[0]),e=parseInt(e[1]);a=a.substr(c+1,a.length);c=a.split("-");a=this._wordAndOccurence(c[0]);c=this._wordAndOccurence(c[1]);return{book:b,chapter:e,start:a,
end:c}}};this._json=function(a){var b=this,c=[];jQuery(a).find("Annotation").each(function(){var a=jQuery(this).find("hasTarget"),a=jQuery(a[0]).attr("rdf:resource"),a=b._target(a);if(void 0==a)return!0;var d=jQuery(this).find("hasBody"),d=jQuery(d[0]).attr("rdf:resource"),d=b._target(d);if(void 0==a)return!0;c.push({target:a,body:d})});return c};this._wordAndOccurence=function(a){var b=a.indexOf("["),c=a.substr(0,b);a=a.substr(b,a.length-1).replace("[","").replace("]","");return{word:c,occurence:a}};
this.apply=function(){for(var a in this.alignments){var b=this._xmlToIds(a);if(void 0==b)console.log("No ids specified for "+a);else{var c=1,e;for(e in this.alignments[a].json){var d=this.alignments[a].json[e];this._mark(b.body,c,d.body);this._mark(b.target,c,d.target);c++}}}};this._xmlToIds=function(a){for(var b in this.config)if(this.config[b].src==a)return this.config[b].ids};this._mark=function(a,b,c){a="#"+a+" "+("#book-"+c.book)+" "+("#chapter-"+c.chapter);var e=jQuery(a).html(),d=c.start;c=
c.end;var f=e.positions(d.word,!1,!0,!0),d=f[d.occurence-1],f=this._highlightColor(b),e=e.insertAt(d,'<span id="'+b+'" class="align" style="background-color:'+f+'">'),f=e.positions(c.word,!1,!0,!0),d=f[c.occurence-1]+c.word.length,e=e.insertAt(d,"</span>");jQuery(a).html(e)};this._highlightColor=function(a){a=this.palette.colors[a%this.palette.colors.length];return"rgba("+a.r+","+a.g+","+a.b+", 0.15 )"};this.loadCheck=function(){for(var a in this.xml)if(!0!=this.alignments[a].loaded)return;jQuery(window).trigger(this.events.loaded)}};
(function(a){function b(a,b,d){this.elem=a;this.id=d;this.init(a,b)}b.prototype.init=function(c,b){a(this.elem).addClass("bodin");this.options=$.extend({scrollPad:40},b);this.events={goTo:"BodinUI-GOTO"};this.start()};b.prototype.start=function(){this.makeRoom();this.sizeCheck();this.buildNav();this.tooltips();void 0!=this.options.milestones&&this.milestones()};b.prototype.makeRoom=function(){var c=a(".bodin").length,b=new Styler,c=parseInt(100/c);b.add({".bodin":"width: "+c+"%"})};b.prototype.sizeCheck=
function(){var c=this;a(window).resize(function(){450>a(c.elem).width()?a(c.elem).addClass("slim"):a(c.elem).removeClass("slim")})};b.prototype.milestones=function(){var c=this,b=0,d=c.options.milestones;a("p",c.elem).each(function(){var c=d[b%d.length];b++;a(this).prepend('<a href="" class="milestone" id="stone-'+b+'">'+c+"</a>")});a(".milestone").on("touchstart click",function(b){b.preventDefault();a(window).trigger(c.events.goTo,[a(this).attr("id")])})};b.prototype.goToMilestone=function(a){a=
$("#"+a,this.elem).position();if(void 0!=a){a=a.top-this.options.scrollPad;var b=$(".work",this.elem).scrollTop();$(".work",this.elem).animate({scrollTop:b+a},1E3)}};b.prototype.buildNav=function(){var c=a(this.elem).attr("id");a(this.elem).prepend('\t\t\t<div id="sidecart_'+c+'"></div>\t\t');a(".edition",this.elem).each(function(){a(".book",this).each(function(){a(".chapter",this).each(function(){})})});a("#sidecart_"+c).sidecart({side:"top",inside:!0,views:[{id:c+"-view-1",type:"nav",link:"index",
src:"#content",init:function(){},refresh:function(){}},{id:c+"-view-2",type:"extras",link:"extras",src:"#content",init:function(){},refresh:function(){}},{id:c+"-view-3",type:"config",link:"config",src:"#content",init:function(){},refresh:function(){}}]})};b.prototype.tooltips=function(){var c=a(this.elem).attr("id");new Tooltipper("#"+c+" .work")};a(document).ready(function(a){a.fn.BodinUI=function(e){var d=a(this).selector;return this.each(function(){a.data(this,d,new b(this,e,d))})}})})(jQuery);
(function(a){function b(a,b,d){this.elem=a;this.id=d;this.init(a,b)}b.prototype.init=function(c,b){this.events={loaded:"TeiToBodin-LOADED"};this.src=a(this.elem).attr("src");void 0==this.src?console.log("src not defined"):this.get()};b.prototype.get=function(){var c=this;a.get(c.src).done(function(b){a(c.elem).html(b);a(c.elem).trigger(c.events.loaded,[c.elem])}).fail(function(){console.log("Could not retrieve data at: "+c.src)})};a(document).ready(function(a){a.fn.TeiToBodin=function(e){var d=a(this).selector;
return this.each(function(){a.data(this,d,new b(this,e,d))})}})})(jQuery);function Tooltipper(a){this.root=a;this.tooltip=jQuery('<div id="tooltipper"></div>');this.start();this.target=null}
Tooltipper.prototype.start=function(){var a=this;jQuery(a.root+" [rel~=tooltip]").bind("touchstart click",function(b){b.preventDefault();a.target=jQuery(this);jQuery(a.root+" #tooltipper").remove();b=jQuery(this).attr("title");if(!b||""==b)return!1;a.tooltip.css("opacity",0).html(b).appendTo("body");a.position()});jQuery(window).resize(function(){a.position()});jQuery(a.root).scroll(function(){a.position()})};
Tooltipper.prototype.position=function(){if(void 0!=this.tooltip&&void 0!=this.target){jQuery(window).width()<1.5*this.tooltip.outerWidth()?this.tooltip.css("max-width",jQuery(window).width()/2):this.tooltip.css("max-width",340);var a=this.target.offset().left+this.target.outerWidth()/2-this.tooltip.outerWidth()/2,b=this.target.offset().top-this.tooltip.outerHeight()-10;0>a?(a=this.target.offset().left+this.target.outerWidth()/2-20,this.tooltip.addClass("left")):this.tooltip.removeClass("left");a+
this.tooltip.outerWidth()>jQuery(window).width()?(a=this.target.offset().left-this.tooltip.outerWidth()+this.target.outerWidth()/2+20,this.tooltip.addClass("right")):this.tooltip.removeClass("right");0>b?(b=this.target.offset().top+this.target.outerHeight()+10,this.tooltip.addClass("top")):this.tooltip.removeClass("top");this.tooltip.css({left:a,top:b});this.tooltip.animate({opacity:1},50)}};
BodinAlign=function(){if(BodinAlign.prototype._singleton)return BodinAlign.prototype._singleton;BodinAlign.prototype._singleton=this;this.src={};this.alignments={};this.config=null;this.ignoreTag={H1:!0,H2:!0};this.ignoreClass={note:!0,milestone:!0};this.palette=new Palette("secondary");this.events={loaded:"BodinAlign-LOADED"};this.start=function(a){this.config=a;for(var b in a)this.src[a[b].src]=1;for(b in this.src)this.alignments[b]={loaded:!1};for(b in this.src)this._get(b)};this._get=function(a){var b=
this;jQuery.get(a).done(function(c){b.alignments[a].xml=c;b.alignments[a].loaded=!0;b.alignments[a].json=b._json(c);b.loadCheck()}).fail(function(){console.log("Could not load alignment xml: "+a)})};this._target=function(a){var b=a.lastIndexOf(":")+1,c=a.indexOf("@");if(-1!=c){var e=a.substr(b,c-b).split("."),b=parseInt(e[0]),e=parseInt(e[1]);a=a.substr(c+1,a.length);c=a.split("-");a=this._wordAndOccurence(c[0]);c=this._wordAndOccurence(c[1]);return{book:b,chapter:e,start:a,end:c}}};this._json=function(a){var b=
this,c=[];jQuery(a).find("Annotation").each(function(){var a=jQuery(this).find("hasTarget"),a=jQuery(a[0]).attr("rdf:resource"),a=b._target(a);if(void 0==a)return!0;var d=jQuery(this).find("hasBody"),d=jQuery(d[0]).attr("rdf:resource"),d=b._target(d);if(void 0==a)return!0;c.push({target:a,body:d})});return c};this._wordAndOccurence=function(a){var b=a.indexOf("["),c=a.substr(0,b);a=a.substr(b,a.length-1).replace("[","").replace("]","");return{word:c,occurence:a}};this.apply=function(){for(var a in this.alignments){var b=
this._xmlToIds(a);if(void 0==b)console.log("No ids specified for "+a);else{var c=1,e;for(e in this.alignments[a].json){var d=this.alignments[a].json[e];this._mark(b.body,c,d.body);this._mark(b.target,c,d.target);c++}}}};this._xmlToIds=function(a){for(var b in this.config)if(this.config[b].src==a)return this.config[b].ids};this._mark=function(a,b,c){a="#"+a+" "+("#book-"+c.book)+" "+("#chapter-"+c.chapter);var e=jQuery(a).html(),d=c.start;c=c.end;var f=e.positions(d.word,!1,!0,!0),d=f[d.occurence-
1],f=this._highlightColor(b),e=e.insertAt(d,'<span id="'+b+'" class="align" style="background-color:'+f+'">'),f=e.positions(c.word,!1,!0,!0),d=f[c.occurence-1]+c.word.length,e=e.insertAt(d,"</span>");jQuery(a).html(e)};this._highlightColor=function(a){return this.palette.colors[a%this.palette.colors.length].toAlpha(0.15)};this.loadCheck=function(){for(var a in this.xml)if(!0!=this.alignments[a].loaded)return;jQuery(window).trigger(this.events.loaded)}};
(function(a){function b(a,b,d){this.elem=a;this.id=d;this.init(a,b)}b.prototype.init=function(c,b){a(this.elem).addClass("bodin");this.options=$.extend({scrollPad:40,blinkAlpha:0.5},b);this.events={milestone:"BodinUI-MILESTONE",align:"BodinUI-ALIGN"};this.start()};b.prototype.start=function(){this.makeRoom();this.sizeCheck();this.buildNav();this.tooltips();this.align();void 0!=this.options.milestones&&this.milestones()};b.prototype.align=function(){var c=this;a(".align",c.elem).on("touchstart click",
function(b){b.preventDefault();a(window).trigger(c.events.align,[a(this).attr("id")])})};b.prototype.alphaBlink=function(c){var b=this,d=a("#"+c,b.elem),f=b._alphaBlinkColors(d);b.blinkCounter=0;for(c=1;9>=c;c++)setTimeout(function(){a(d).css("background-color",f[b.blinkCounter%f.length]);b.blinkCounter++},500*c)};b.prototype._alphaBlinkColors=function(c){c=a(c).css("background-color");var b=c.substring(c.indexOf("(")+1,c.indexOf(")")-1).split(",");b[3]=this.options.blinkAlpha;b="rgba("+b.join(",")+
")";return[c,b]};b.prototype.makeRoom=function(){var c=a(".bodin").length,b=new Styler,c=parseInt(100/c);b.add({".bodin":"width: "+c+"%"})};b.prototype.sizeCheck=function(){var c=this;a(window).resize(function(){450>a(c.elem).width()?a(c.elem).addClass("slim"):a(c.elem).removeClass("slim")})};b.prototype.milestones=function(){var c=this,b=0,d=c.options.milestones;a("p",c.elem).each(function(){var c=d[b%d.length];b++;a(this).prepend('<a href="" class="milestone" id="stone-'+b+'">'+c+"</a>")});a(".milestone").on("touchstart click",
function(b){b.preventDefault();a(window).trigger(c.events.milestone,[a(this).attr("id")])})};b.prototype.goTo=function(a){a=$("#"+a,this.elem).position();if(void 0!=a){a=a.top-this.options.scrollPad;var b=$(".work",this.elem).scrollTop();$(".work",this.elem).animate({scrollTop:b+a},1E3)}};b.prototype.buildNav=function(){var b=a(this.elem).attr("id");a(this.elem).prepend('\t\t\t<div id="sidecart_'+b+'"></div>\t\t');var e="<ul>",d=1;a(".edition",this.elem).each(function(){var b=a(this).attr("id");e+=
'<li><a href="#'+b+'">Edition -- '+d+"</a></li>";e+="<ul>";d++;var c=1;a(".book",this).each(function(){var b=a(this).attr("id");e+='<li><a href="#'+b+'">Book -- '+c+"</a></li>";e+="<ul>";c++;var d=1;a(".chapter",this).each(function(){var b=a("h1",this).text(),c=a("h2",this).text(),f="Chapter -- "+d;""!=b&&(f="<div>"+b+"</div><div>"+c+"</div>");b=a(this).attr("id");e+='<li><a href="#'+b+'">'+f+"</a></li>";d++});e+="</ul>"});e+="</ul>"});e+="</ul>";this.sidecart=a("#sidecart_"+b).sidecart({side:"top",
inside:!0,views:[{id:b+"-view-1",type:"nav",link:"index",text:e,init:function(){},refresh:function(){}}]}).data("#sidecart_"+b);this.navEvents()};b.prototype.navEvents=function(){var b=this,e=a(b.elem).attr("id");a("#sidecart_"+e+" .nav a",this.elem).on("touchstart click",function(d){d.preventDefault();d=a(this).attr("href").replace("#","");b.sidecart.hide();b.goTo(d)})};b.prototype.tooltips=function(){var b=a(this.elem).attr("id");new Tooltipper("#"+b+" .work")};a(document).ready(function(a){a.fn.BodinUI=
function(e){var d=a(this).selector;return this.each(function(){a.data(this,d,new b(this,e,d))})}})})(jQuery);
(function(a){function b(a,b,d){this.elem=a;this.id=d;this.init(a,b)}b.prototype.init=function(b,e){this.events={loaded:"TeiToBodin-LOADED"};this.src=a(this.elem).attr("src");void 0==this.src?console.log("src not defined"):this.get()};b.prototype.get=function(){var b=this;a.get(b.src).done(function(e){a(b.elem).html(e);a(b.elem).trigger(b.events.loaded,[b.elem])}).fail(function(){console.log("Could not retrieve data at: "+b.src)})};a(document).ready(function(a){a.fn.TeiToBodin=function(e){var d=a(this).selector;
return this.each(function(){a.data(this,d,new b(this,e,d))})}})})(jQuery);function Tooltipper(a){this.root=a;this.tooltip=jQuery('<div id="tooltipper"></div>');this.start();this.target=null}
Tooltipper.prototype.start=function(){var a=this;jQuery(a.root+" [rel~=tooltip]").bind("touchstart click",function(b){b.preventDefault();a.target=jQuery(this);jQuery(a.root+" #tooltipper").remove();b=jQuery(this).attr("title");if(!b||""==b)return!1;a.tooltip.css("opacity",0).html(b).appendTo("body");a.position()});jQuery(window).resize(function(){a.position()});jQuery(a.root).scroll(function(){a.position()})};
Tooltipper.prototype.position=function(){if(void 0!=this.tooltip&&void 0!=this.target){jQuery(window).width()<1.5*this.tooltip.outerWidth()?this.tooltip.css("max-width",jQuery(window).width()/2):this.tooltip.css("max-width",340);var a=this.target.offset().left+this.target.outerWidth()/2-this.tooltip.outerWidth()/2,b=this.target.offset().top-this.tooltip.outerHeight()-10;0>a?(a=this.target.offset().left+this.target.outerWidth()/2-20,this.tooltip.addClass("left")):this.tooltip.removeClass("left");a+
this.tooltip.outerWidth()>jQuery(window).width()?(a=this.target.offset().left-this.tooltip.outerWidth()+this.target.outerWidth()/2+20,this.tooltip.addClass("right")):this.tooltip.removeClass("right");0>b?(b=this.target.offset().top+this.target.outerHeight()+10,this.tooltip.addClass("top")):this.tooltip.removeClass("top");this.tooltip.css({left:a,top:b});this.tooltip.animate({opacity:1},50)}};

